# 多平台房价数据爬虫

这是一个用于爬取多个房产网站（安居客、58同城、贝壳找房、链家）的房价数据的Python程序，可以按照户型（几室几厅）和建筑年份进行筛选，并将结果保存到Excel表格中。

## 功能特点

- **多平台支持**：爬取主流房产网站（安居客、58同城、贝壳找房、链家）
- **多城市支持**：支持全国主要城市的房源数据爬取
- **多类型支持**：爬取新房、二手房和租房数据
- **筛选功能**：支持按照户型（几室几厅）和建筑年份筛选
- **自动验证**：内置自动处理验证码功能，减少人工干预
- **数据导出**：将结果保存为Excel表格，方便分析和处理
- **数据分析**：提供基本的数据分析功能，生成分析报告
- **命令行支持**：支持通过命令行参数直接运行，方便批处理和自动化
- **图形界面**：提供图形用户界面，更加方便操作和使用
- **跳过验证**：支持自动跳过验证页面，继续爬取后续页面或平台
- **户型图提取**：支持自动提取房源户型图链接
- **批量爬取**：支持批量爬取多个城市的数据

## 系统要求

- Python 3.6 或更高版本
- 必要的Python库（详见`setup.py`）
- Chrome浏览器和对应版本的ChromeDriver（用于自动验证功能）

## 快速开始

### 安装和配置

1. 克隆或下载本项目

2. 使用安装脚本进行依赖安装和环境配置
```bash
python setup.py
```
这个脚本会：
- 检查Python版本
- 安装所需的依赖库
- 检查Chrome浏览器和ChromeDriver
- 创建必要的目录
- 测试安装是否成功

### 运行爬虫

#### 图形界面模式（推荐）

```bash
python gui_scraper.py
```

图形界面提供了以下功能：
- 平台选择（支持多选）：安居客、58同城、贝壳找房、链家
- 城市选择：支持全国主要城市
- 房源类型选择：新房、二手房、租房
- 筛选条件设置：卧室数、客厅数、建筑年份
- 批量模式：可选择多个城市进行批量爬取
- 跳过验证选项：自动跳过验证页面，继续爬取
- 实时日志显示：爬取过程的实时状态和信息
- 数据导出：将爬取的数据导出为Excel文件
- 数据清除：清除已爬取的数据

#### 交互模式

```bash
python multi_platform_housing_scraper.py
```

按照程序提示选择相应的选项：
1. 选择爬取的平台
2. 选择爬取的城市
3. 选择房源类型（新房/二手房/租房）
4. 设置筛选条件（户型、建筑年份等）
5. 设置爬取页数

#### 命令行模式

```bash
python multi_platform_housing_scraper.py --platform anjuke --city zz --type 二手房 --pages 5 --bedroom 3
```

主要参数说明：
- `--platform`：爬取平台，可选值：anjuke(安居客), 58(58同城), beike(贝壳找房), lianjia(链家), all(所有平台)
- `--city`：城市名称或城市代码，例如：郑州 或 zz
- `--type`：房源类型，多个类型用逗号分隔，例如：新房,二手房,租房
- `--pages`：爬取页数，默认为3
- `--bedroom`：卧室数量筛选
- `--livingroom`：客厅数量筛选
- `--year`：建筑年份筛选
- `--output`：输出文件名，不指定则使用默认命名
- `--debug`：开启调试模式，输出更详细的日志
- `--clear`：清空之前爬取的数据
- `--headless`：使用无头浏览器模式进行自动验证
- `--no-verify`：禁用自动验证，遇到验证码时直接跳过

完整的命令行选项可以通过以下命令查看：
```bash
python multi_platform_housing_scraper.py --help
```

## 验证码处理

本项目内置了自动处理验证码的功能，支持以下类型的验证处理：

1. **滑块验证**：通过模拟人类行为的轨迹算法自动拖动滑块
2. **点击验证**：自动尝试点击图片中可能的验证区域
3. **手动处理**：如果自动处理失败，会打开浏览器供用户手动验证
4. **跳过验证**：可以选择自动跳过验证，继续爬取下一页或下一个平台

如果遇到验证码问题：
- 确保已安装Selenium和相关依赖
- 确保Chrome浏览器和ChromeDriver版本匹配
- 查看`verification_debug`目录中的截图，了解验证失败的原因
- 如果频繁遇到验证码，尝试减慢爬取速度或更换IP地址
- 在GUI界面中，可以选择"跳过验证"选项，自动跳过需要验证的页面

## 数据存储与分析

### 数据存储

爬取的数据将保存在`output_data`目录下的Excel文件中，文件名格式为：
`house_data_YYYYMMDD_HHMMSS.xlsx`

包含以下信息：
- 平台
- 城市
- 房源名称
- 价格
- 地址
- 户型
- 面积
- 建筑年份
- 类型
- 纬度和经度
- 详情页链接
- 户型图链接

### 数据分析

爬虫程序提供了基本的数据分析功能，可以生成分析报告：

```python
# 在爬取数据后，可以调用analyze_data方法进行分析
scraper.analyze_data()
```

分析报告会生成在`housing_data`目录下，文件名格式为：
`房源数据分析报告_YYYYMMDD_HHMMSS.xlsx`

分析报告包含以下内容：
- **数据总览**：总房源数、平台分布、房源类型分布
- **平台分析**：各平台房源数量、价格统计等
- **价格分析**：最低价、最高价、平均价、中位数、价格区间分布
- **户型分析**：不同户型的房源数量分布
- **区域分析**：热门区域房源分布
- **原始数据**：完整的爬取数据

## 排错指南

### 常见问题

1. **无法找到房源数据**
   - 检查选择器是否更新（网站可能更改了HTML结构）
   - 检查`debug_pages`目录中保存的页面文件

2. **验证码处理失败**
   - 检查`verification_debug`目录中的截图
   - 确认Chrome和ChromeDriver版本匹配
   - 尝试手动处理验证码
   - 启用"跳过验证"选项，继续爬取其他页面或平台

3. **程序崩溃或异常**
   - 查看`housing_scraper.log`日志文件
   - 检查依赖项是否正确安装

### 日志文件

项目会生成以下日志文件：
- `housing_scraper.log`：主爬虫日志
- `verification.log`：验证码处理日志

## 最近更新

### 版本 2.0.0 (2025-04-25)
- **新增功能**:
  - 增加图形用户界面 (GUI) 支持，更加直观易用
  - 添加"跳过验证"功能，遇到验证页面时自动跳过继续爬取
  - 支持批量爬取多个城市的数据
  - 增加户型图提取功能，自动获取房源户型图链接
  - 改进验证码检测算法，提高检测准确率
  - 增加更多数据字段，包括经纬度、详情页链接等

- **修复问题**:
  - 修复安居客验证检测中的语法错误
  - 修复58同城和贝壳平台验证检测缺少返回语句的问题
  - 修复 GUI 界面默认选择平台的问题，现在默认为安居客
  - 修复"年份"变量在某些执行路径中未初始化的问题
  - 增强错误处理和日志记录，提高程序健壮性

## 安全与合规

- 本项目仅供学习和研究使用，请勿用于商业目的
- 请遵守网站的robots.txt规则
- 建议设置合理的爬取间隔，避免给目标网站带来过大负担
- 爬取的数据请勿用于违法用途

## 许可证

本项目采用 MIT 许可证 - 详情见 [LICENSE](LICENSE) 文件 